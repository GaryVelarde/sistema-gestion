<style>
    ::ng-deep .p-tag-value {
        font-size: 1rem;
    }
</style>
<div class="card">
    <p>Complete todos los campos para continuar.</p>
    <p-toast key="tst"></p-toast>
    <form [formGroup]="presenter.formStep4">
        <div class="grid p-fluid mt-3">
            <div
                *ngIf="statusTitlesList === 'complete'"
                class="field col-12 md:col-12"
            >
                <span class="p-float-label">
                    <textarea
                        formControlName="title"
                        inputId="textarea"
                        rows="4"
                        cols="30"
                        pInputTextarea
                    ></textarea>
                    <label for="textarea">Título del proyecto de tesis</label>
                </span>
            </div>
            <div *ngIf="statusTitlesList === 'charging'" class="col-12">
                <p-skeleton class="w-full" height="90px" />
            </div>
            <div *ngIf="statusTitlesList === 'error'" class="col-12">
                <app-label-error [message]="messsageTitlesError" (reload)="callGetTitlesList()">
                </app-label-error>
            </div>
        </div>
        <div
            *ngIf="results.length > 0 || presenter.title.value"
            class="grid p-fluid mb-4"
        >
            <div class="col-12">
                <div class="grid d-flex mx-2">
                    <b class="mr-auto"
                        >Se encontraron {{results.length}} tesis con un
                        porcentaje de similitud del {{minimumPercentage}}% o más
                        con respecto al título proporcionado.</b
                    >
                    <i
                        class="pi pi-cog cursor-pointer"
                        style="font-size: 1.3rem"
                        (click)="showConfigCompareTitle()"
                    ></i>
                </div>
                <p-table
                    *ngIf="results.length > 0"
                    [value]="results"
                    [tableStyle]="{'width': '100%', 'margin-top': '14px'}"
                >
                    <ng-template pTemplate="header">
                        <tr>
                            <th>Tesis</th>
                            <th>Similitud</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-data>
                        <tr>
                            <td>{{data.title}}</td>
                            <!-- <td [style]="data.similarity > '80.00' ? '#ef4444' : ''">{{data.similarity}}%</td> -->
                            <td>
                                <p-tag
                                    [value]="data.similarity + '%'"
                                    [severity]="getSeverity(data.similarity)"
                                />
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </div>
        <div class="grid p-fluid">
            <div class="field col-12 md:col-4">
                <span class="p-float-label">
                    <p-calendar
                        inputId="approvalDate"
                        formControlName="approveDate"
                    ></p-calendar>
                    <label for="approvalDate">Fecha de aprobación UDI</label>
                </span>
            </div>
            <div class="field col-12 md:col-4">
                <span class="p-float-label">
                    <input
                        formControlName="jobNumber"
                        type="text"
                        id="jobNumber"
                        pKeyFilter="int"
                        pInputText
                    />
                    <label for="jobNumber">Número de oficio</label>
                </span>
            </div>
            <div class="field col-12 md:col-4">
                <span class="p-float-label">
                    <input
                        formControlName="resolutionNumber"
                        type="text"
                        id="resolutionNumber"
                        pKeyFilter="int"
                        pInputText
                    />
                    <label for="resolutionNumber">Número de resolución</label>
                </span>
            </div>
        </div>
        <div class="grid p-fluid">
            <div class="field col-12 md:col-12">
                <span class="p-float-label">
                    <textarea
                        formControlName="comments"
                        inputId="textarea"
                        rows="4"
                        cols="30"
                        pInputTextarea
                    ></textarea>
                    <label for="textarea"
                        >Comentarios u observaciones (opcional)</label
                    >
                </span>
            </div>
        </div>
        <div class="grid p-fluid">
            <app-upload-archives
                class="w-full"
                (onFileChangeEmitter)="onFileChange($event)"
                (clearFilesEmitter)="clearFile()"
            ></app-upload-archives>
        </div>
        <div class="flex gap-3 mt-1">
            <p-button
                (click)="backStep()"
                label="Regresar"
                [outlined]="true"
                icon="pi pi-angle-left"
                iconPos="left"
            />
            <p-button
                (click)="finalize()"
                label="Finalizar"
                icon="pi pi-check"
                iconPos="right"
                [disabled]="presenter.formStep4.invalid"
            />
        </div>
    </form>
</div>

<p-dialog
    header="Configuración de similitud de título de tesis"
    [modal]="true"
    [(visible)]="configCompareTitle"
    [style]="{ width: '45rem' }"
    [closeOnEscape]="false"
    [draggable]="false"
    [closable]="false"
>
    <span class="p-text-secondary block mb-5"
        >Porcentaje mínimo de similitud.</span
    >
    <div class="justify-content-center gap-3 mb-3">
        <div class="flex">
            <input
                type="text"
                style="width: 50px"
                pInputText
                [(ngModel)]="minimumPercentage"
                class="mb-3"
            />
            <label class="label-porcantaje">%</label>
        </div>
        <div class="w-full">
            <p-slider [(ngModel)]="minimumPercentage" class="w-full" />
        </div>
    </div>
    <div class="flex justify-content-end gap-2">
        <p-button
            label="Cancelar"
            severity="secondary"
            (onClick)="cancelConfigCompareTitle()"
        />
        <p-button label="Guardar" (onClick)="saveConfigCompareTitle()" />
    </div>
</p-dialog>
